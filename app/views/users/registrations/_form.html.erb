<% unless current_user.nil? %>
   <% if current_user.identities.count > 0 %>
        <%= image_tag current_user.identities.first.image %>
   <% end %>
<% end %>

<% unless browser.ie? %>
    <%= javascript_include_tag 'facebook-modal' %>
<% end %>

<%= link_to 'Sign in with facebook', user_omniauth_authorize_path(:facebook), id: 'sign_in', class: 'popup facebook_sign_in', html: {multipart: true},
            data: { width: 600, height: 400} %>

<%= simple_form_for(resource, :as => resource_name, :html => { :class => 'form-horizontal' }, :url => registration_path(resource_name), :remote => true) do |f| %>

  <%= f.input :email, required: true, autofocus: true, class: 'submittable', placeholder: 'Enter Email',
              input_html: { data: { validatation: 'email' } }%><div id='spinner'></div>
  <%= f.input :first_name, placeholder: 'First Name', label: false, title: 'Enter your first name',
              input_html: { data: { required: true }, class: 'alpha_length' }%>
  <%= f.input :last_name, placeholder: 'Last Name', label: false, title: 'Enter your last name', input_html: { class: 'alpha_length' } %>
  <%= f.input :password, required: true, placeholder: 'Password', label: false %>
  <%= f.input :password_confirmation, required: true, placeholder: 'Repeat Password', label: false %>
  <%= f.input :address, placeholder: 'Address', label: false, title: 'Enter your address' %>
  <%= f.input :postal_code, placeholder: 'Postal Code' , input_html: { onblur: 'findRiding("' + find_riding_url + '")', class: 'postal_code' },
              label: false, title: 'Enter your postal code' %>
  <span id='riding_box'></span>
  <%= f.hidden_field :riding_id %>
  <%= f.input :city, placeholder: 'City', label: false, title: 'Enter your city' %>
  <%= f.input :phone_number, as: :tel, :size => 30, placeholder: 'Phone Number', label: false, title: 'Enter your phone number', input_html: {class: 'phone_number'} %>
  <%= f.input :birthday, :input_html => { :class => 'datepicker dd_mm_yyyy', value: Date._strptime("%d/%m/%Y") } %>
  <%= f.file_field :image, as: :image_preview, input_html: {preview_version: :thumb} %>
  <%= f.hidden_field :image_cache %>
  <%= f.button :submit, 'Sign up', :class => 'btn-primary' %>
  <div id="errors"></div>

<% end %>

<%= render 'users/shared/links' %>

    <%# javascript_include_tag 'MUX.loader' %>
    <%= javascript_include_tag 'moment/moment-with-langs.min' %>

    <script>
        initializeValidation();

        function popupCenter(url, width, height, name) {
            var left = (screen.width/2)-(width/2);
            var top = (screen.height/2)-(height/2);
            return window.open(url, name, "menubar=no,toolbar=no,status=no,width="+width+",height="+height+",toolbar=no,left="+left+",top="+top);
        }

        $("a.popup").click(function(e) {
            vex.close();
            popupCenter($(this).attr("href"), $(this).attr("data-width"), $(this).attr("data-height"), "authPopup");
            e.stopPropagation(); return false;
        });

        var ajaxyLoader;

//        $( this ).ajaxStart(function() {
//            console.log( "Triggered ajaxStart handler." );
//            //$('.loader').show();
//            ajaxyLoader = new ajaxLoader($('body'), {bgColor: '#fff', duration: 800, opacity: 0.7, classOveride: "loader"});
//        });
//
//        $( this ).ajaxStop(function() {
//            console.log( "Triggered ajaxStop handler." );
//            setTimeout(function(){
//                ajaxyLoader.remove();
//            }, 3000);
//        });

    </script>s